<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your SDL Project</title>
</head>
<body style="margin: 0; display: flex; flex-direction: column; align-items: center; padding-top: 16px;">
    <button type="button" id="game-start-button">
        <span>Start Game!</span>
    </button>

    <div id="game-container">
        <div id="status">Loading...</div>
        <canvas id="game-board" width="500" height="600" style="display:none"></canvas>
    </div>

    <script>
        // Flag to check if the start button was clicked
        let startGameRequested = false;

        // Emscripten Module setup
        var Module = {
            // This function runs after the WebAssembly runtime is fully initialized
            onRuntimeInitialized() {
                const status = document.getElementById('status');
                status.remove();

                // Only call start_game if the start button was clicked
                if (startGameRequested) {
                    Module.ccall('start_game', null, [], []);
                }
            },
            canvas: (function () {
                const canvas = document.getElementById('game-board');
                return canvas;
            })(),
            // Prevents main() from automatically starting
            noInitialRun: true
        };

        // DOM Elements
        const startGameButton = document.getElementById('game-start-button');
        const canvas = document.getElementById('game-board');

        // Button event listener to start the game
        startGameButton.addEventListener('click', () => {
            canvas.style.display = 'block';
            startGameButton.remove();
            startGameRequested = true; // Set the flag to indicate start was requested

            // Dynamically load the game script only when the button is clicked
            var script = document.createElement('script');
            script.src = "./flappy-bird.js";
            document.body.appendChild(script);
        });
    </script>
</body>
</html>
